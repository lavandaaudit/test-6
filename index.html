<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>COSMOS · DYNAMIC COORDINATE SYSTEM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{
  margin:0;
  padding:0;
  background:#000;
  overflow:hidden;
  font-family:'Courier New', monospace;
}
#hud{
  position:absolute;
  top:14px;
  left:14px;
  color:#0af;
  font-size:13px;
  opacity:0.8;
}
#info{
  position:absolute;
  bottom:14px;
  left:14px;
  color:#0f0;
  font-size:10px;
  opacity:0.6;
  max-width:360px;
}
canvas{display:block;}
</style>
</head>

<body>
<div id="hud">Lavanda · COSMOS COORDINATE SYSTEM</div>
<div id="info">ініціалізація…</div>
<canvas id="c"></canvas>

<script>
/* ───────── CANVAS ───────── */
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const info = document.getElementById('info');
function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener('resize',resize); resize();

/* ───────── TIME ───────── */
let t = 0;

/* ───────── DATA STATE ───────── */
const state = {
  wind:0,
  kp:0,
  dst:0,
  f107:0,
  sunspots:0,
  cme:0,
  proton:0,
  xray:0
};

const proxy='https://corsproxy.io/?';

/* ───────── FETCH ───────── */
async function j(url){
  try{
    const r=await fetch(proxy+encodeURIComponent(url));
    return r.ok? r.json():null;
  }catch{return null;}
}

async function updateData(){
  const plasma=await j('https://services.swpc.noaa.gov/products/solar-wind/plasma-7-day.json');
  if(plasma?.length){
    state.wind=+plasma.at(-1)[3]||0;
  }

  const kp=await j('https://services.swpc.noaa.gov/products/noaa-planetary-k-index.json');
  if(kp?.length) state.kp=+kp.at(-1)[1]||0;

  const dst=await j('https://services.swpc.noaa.gov/products/kyoto-dst.json');
  if(dst?.length) state.dst=+dst.at(-1)[1]||0;

  const f107=await j('https://services.swpc.noaa.gov/json/f107.json');
  if(f107?.length) state.f107=+f107.at(-1).flux||0;

  const sun=await j('https://services.swpc.noaa.gov/json/sunspot/sunspot.json');
  if(sun?.length) state.sunspots=+sun.at(-1).ssn||0;

  const d=new Date().toISOString().slice(0,10);
  const cme=await j(`https://api.nasa.gov/DONKI/CME?startDate=${d}&endDate=${d}&api_key=DEMO_KEY`);
  state.cme=Array.isArray(cme)?cme.length:0;

  const proton=await j('https://services.swpc.noaa.gov/json/goes/primary/proton-flux.json');
  if(proton?.length) state.proton=proton.at(-1)['>10 MeV']||0;

  const xray=await j('https://services.swpc.noaa.gov/json/goes/primary/xray-flares-latest.json');
  if(xray?.length) state.xray=xray[0].flux||0;

  info.innerHTML=
    `SolarWind ${state.wind} km/s<br>
     Kp ${state.kp} | Dst ${state.dst}<br>
     F10.7 ${state.f107} | SSN ${state.sunspots}<br>
     CME ${state.cme} | Proton ${state.proton}`;
}

updateData();
setInterval(updateData,60000);

/* ───────── DRAW COORD SYSTEM ───────── */
function drawGrid(cx,cy,r){
  ctx.strokeStyle='#033';
  ctx.lineWidth=1;

  for(let i=1;i<=5;i++){
    ctx.beginPath();
    ctx.arc(cx,cy,(r/5)*i,0,Math.PI*2);
    ctx.stroke();
  }

  for(let a=0;a<Math.PI*2;a+=Math.PI/6){
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.lineTo(cx+Math.cos(a)*r,cy+Math.sin(a)*r);
    ctx.stroke();
  }

  ctx.strokeStyle='#055';
  ctx.beginPath();
  ctx.moveTo(0,cy); ctx.lineTo(canvas.width,cy);
  ctx.moveTo(cx,0); ctx.lineTo(cx,canvas.height);
  ctx.stroke();
}

/* ───────── DRAW DATA ───────── */
function drawVectors(cx,cy,r){
  const values=[
    state.wind/900,
    state.kp/9,
    Math.abs(state.dst)/200,
    state.f107/250,
    state.sunspots/200,
    state.cme/10,
    Math.log10(state.proton+1)/5,
    state.xray*1e8
  ];

  ctx.beginPath();
  values.forEach((v,i)=>{
    const ang=(Math.PI*2/values.length)*i + t*0.1;
    const rad=r*0.2 + v*r*0.8;
    const x=cx+Math.cos(ang)*rad;
    const y=cy+Math.sin(ang)*rad;
    i?ctx.lineTo(x,y):ctx.moveTo(x,y);
  });
  ctx.closePath();

  ctx.strokeStyle='rgba(0,255,255,0.8)';
  ctx.lineWidth=2;
  ctx.stroke();

  ctx.fillStyle='rgba(0,255,255,0.15)';
  ctx.fill();
}

/* ───────── LOOP ───────── */
function loop(){
  t+=0.01;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const cx=canvas.width/2;
  const cy=canvas.height/2;
  const r=Math.min(cx,cy)*0.75;

  drawGrid(cx,cy,r);
  drawVectors(cx,cy,r);

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
