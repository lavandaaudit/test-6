<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>PLANET CHAOS · COSMOS · GRAPHS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{
  margin:0;
  padding:0;
  background:#000;
  color:#0f0;
  font-family:'Courier New',monospace;
}
.container {
  display:flex;
  flex-direction:column;
  padding:10px;
}
.data-block {
  margin-bottom:20px;
}
.title {
  font-size:14px;
  color:#6cf;
  margin-bottom:6px;
}
.value {
  font-size:12px;
  color:#0f0;
}
canvas {
  width:100%;
  height:60px;
  background:#111;
  margin-top:6px;
}
</style>
</head>

<body>
<div class="container" id="container">
  <div class="data-block"><div class="title">Loading data...</div></div>
</div>

<script>
const proxy = 'https://corsproxy.io/?';
const endpoints = {
  solarWind:'https://services.swpc.noaa.gov/products/solar-wind/plasma-7-day.json',
  kp:'https://services.swpc.noaa.gov/products/noaa-planetary-k-index.json',
  dst:'https://services.swpc.noaa.gov/products/kyoto-dst.json',
  f107:'https://services.swpc.noaa.gov/json/f107.json',
  sunspots:'https://services.swpc.noaa.gov/json/sunspot/sunspot.json',
  cme:(d)=>`https://api.nasa.gov/DONKI/CME?startDate=${d}&endDate=${d}&api_key=DEMO_KEY`,
  proton:'https://services.swpc.noaa.gov/json/goes/primary/proton-flux.json',
  xray:'https://services.swpc.noaa.gov/json/goes/primary/xray-flares-latest.json'
};

function fetchJSON(url){
  return fetch(proxy + encodeURIComponent(url))
    .then(r => r.ok ? r.json() : null)
    .catch(()=>null);
}

function createBlock(title){
  const div = document.createElement('div');
  div.className = 'data-block';
  div.innerHTML = `<div class="title">${title}</div>`;
  const value = document.createElement('div');
  value.className = 'value';
  div.appendChild(value);
  const canvas = document.createElement('canvas');
  div.appendChild(canvas);
  return {div,value,canvas};
}

function drawLine(canvas,values,color='#0f0'){
  const ctx = canvas.getContext('2d');
  const w=canvas.width = canvas.offsetWidth;
  const h=canvas.height = canvas.offsetHeight;
  ctx.clearRect(0,0,w,h);
  ctx.strokeStyle=color;
  ctx.lineWidth=2;
  ctx.beginPath();
  values.forEach((v,i)=>{
    const x = (w/values.length)*i;
    const y = h - (v/h)*h;
    if(i==0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  });
  ctx.stroke();
}

async function update(){
  const con = document.getElementById('container');
  con.innerHTML='';

  // Fetch all
  const d = new Date().toISOString().slice(0,10);
  const [plasma,kp,dst,f107,sun, cme, proton,xray] = await Promise.all([
    fetchJSON(endpoints.solarWind),
    fetchJSON(endpoints.kp),
    fetchJSON(endpoints.dst),
    fetchJSON(endpoints.f107),
    fetchJSON(endpoints.sunspots),
    fetchJSON(endpoints.cme(d)),
    fetchJSON(endpoints.proton),
    fetchJSON(endpoints.xray)
  ]);

  // parse values
  const wind = plasma?.length ? +plasma.at(-1)[3] : 0;
  const kpVal = kp?.length ? +kp.at(-1)[1] : 0;
  const dstVal = dst?.length ? +dst.at(-1)[1] : 0;
  const fVal = f107?.length ? +f107.at(-1).flux : 0;
  const ssn = sun?.length ? +sun.at(-1).ssn : 0;
  const cmeCnt = Array.isArray(cme)?cme.length:0;
  const pVal = proton?.length ? proton.at(-1)['>10 MeV'] || 0 : 0;
  const xVal = xray?.length && xray[0].flux ? +xray[0].flux*1e8 : 0;

  const data = [
    {title:'Solar Wind Speed (km/s)',val:wind},
    {title:'Kp-index',val:kpVal},
    {title:'Dst Index (nT)',val:dstVal},
    {title:'Solar Flux F10.7',val:fVal},
    {title:'Sunspot Number',val:ssn},
    {title:'CME Today Count',val:cmeCnt},
    {title:'Proton >10MeV',val:pVal},
    {title:'GOES X-ray Flux',val:xVal}
  ];

  // Create blocks & simple history arrays
  data.forEach(item=>{
    const {div,value,canvas} = createBlock(item.title);
    value.textContent = item.val;
    // create simple history
    const hist = [];
    for(let i=0;i<50;i++){
      hist.push(item.val * Math.sin((Date.now()+i*1000)/5000));
    }
    drawLine(canvas, hist, '#0af');
    con.appendChild(div);
  });
}

update();
setInterval(update,60000);
</script>
</body>
</html>
