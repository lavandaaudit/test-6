<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>PLANET CHAOS · COSMOS · SUN</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body {
  margin:0;
  padding:0;
  background:#000;
  height:100%;
  font-family:'Courier New', monospace;
  color:#0af;
  overflow:hidden;
}
#hud {
  position:absolute;
  top:16px;
  left:16px;
  font-size:14px;
  opacity:0.85;
}
#status {
  position:absolute;
  top:40px;
  left:16px;
  font-size:11px;
  opacity:0.6;
  color:#0f0;
}
#data {
  position:absolute;
  top:70px;
  left:16px;
  right:16px;
  bottom:16px;
  font-size:11px;
  line-height:1.35;
  color:#0f0;
  overflow-y:auto;
}
#clock {
  position:absolute;
  bottom:16px;
  right:16px;
  font-size:11px;
  opacity:0.45;
  text-align:right;
}
.category {
  margin:18px 0 6px 0;
  font-size:13px;
  color:#0af;
  font-weight:bold;
}
.row { white-space:pre; }
.label { color:#6cf; }
.val-safe { color:#0f0; }
.val-watch { color:#ffd700; }
.val-warn { color:#ff8c00; }
.val-danger { color:#f00; }
</style>
</head>

<body>
<div id="hud">Lavanda.audit.ibonarium.project · COSMOS / SUN</div>
<div id="status">ініціалізація…</div>
<div id="data">завантаження…</div>
<div id="clock"></div>

<script>
const dataDiv = document.getElementById('data');
const statusDiv = document.getElementById('status');
const clockDiv = document.getElementById('clock');
const proxy = 'https://corsproxy.io/?';
const startTime = Date.now();

/* ───────── CLOCK ───────── */
function updateClock(){
  const d = new Date();
  const up = Math.floor((Date.now()-startTime)/1000);
  clockDiv.innerHTML =
    `${d.toLocaleTimeString()}<br>uptime ${up}s`;
}
setInterval(updateClock,1000); updateClock();

/* ───────── HELPERS ───────── */
function color(v,{watch,warn,danger}){
  if (v===null || v==='--' || isNaN(v)) return 'val-safe';
  if (danger!==undefined && v>=danger) return 'val-danger';
  if (warn!==undefined && v>=warn) return 'val-warn';
  if (watch!==undefined && v>=watch) return 'val-watch';
  return 'val-safe';
}

async function fetchJSON(url){
  try{
    const r = await fetch(proxy+encodeURIComponent(url));
    return r.ok ? r.json() : null;
  }catch{ return null; }
}

/* ───────── MAIN ───────── */
async function loadCosmos(){
  statusDiv.textContent = 'оновлення космічних даних…';
  let html = '<div class="category">КОСМОС / СОНЦЕ</div>';
  let count = 0;

  /* ── SOLAR WIND ── */
  const plasma = await fetchJSON(
    'https://services.swpc.noaa.gov/products/solar-wind/plasma-7-day.json'
  );
  if (plasma?.length>1){
    const p = plasma.at(-1);
    const speed = +p[3]||0;
    const dens  = +p[6]||0;
    const temp  = +p[7]||0;
    html += `<div class="row"><span class="label">Solar Wind Speed </span>
      <span class="${color(speed,{watch:500,warn:700,danger:900})}">${speed.toFixed(0)} km/s</span></div>`;
    html += `<div class="row"><span class="label">Solar Wind Density </span>
      <span class="${color(dens,{watch:15,warn:30,danger:50})}">${dens.toFixed(1)} /cm³</span></div>`;
    html += `<div class="row"><span class="label">Solar Wind Temp </span>
      <span class="${color(temp/1000,{watch:100,warn:300,danger:500})}">${temp.toFixed(0)} K</span></div>`;
    count+=3;
  }

  /* ── KP INDEX ── */
  const kp = await fetchJSON(
    'https://services.swpc.noaa.gov/products/noaa-planetary-k-index.json'
  );
  if (kp?.length){
    const v = +kp.at(-1)[1];
    html += `<div class="row"><span class="label">Kp-index </span>
      <span class="${color(v,{watch:5,warn:6,danger:7})}">${v.toFixed(2)}</span></div>`;
    count++;
  }

  /* ── DST INDEX ── */
  const dst = await fetchJSON(
    'https://services.swpc.noaa.gov/products/kyoto-dst.json'
  );
  if (dst?.length){
    const v = +dst.at(-1)[1];
    html += `<div class="row"><span class="label">Dst Index </span>
      <span class="${color(-v,{watch:50,warn:100,danger:200})}">${v} nT</span></div>`;
    count++;
  }

  /* ── CME (NASA DONKI) ── */
  const d = new Date().toISOString().slice(0,10);
  const cme = await fetchJSON(
    `https://api.nasa.gov/DONKI/CME?startDate=${d}&endDate=${d}&api_key=DEMO_KEY`
  );
  if (Array.isArray(cme)){
    html += `<div class="row"><span class="label">CME today count </span>
      <span class="${cme.length?'val-watch':'val-safe'}">${cme.length}</span></div>`;
    if (cme[0]?.cmeAnalyses?.[0]?.speed){
      html += `<div class="row"><span class="label">Latest CME speed </span>
        <span>${cme[0].cmeAnalyses[0].speed} km/s</span></div>`;
      count++;
    }
    count++;
  }

  /* ── GOES X-RAY ── */
  const xray = await fetchJSON(
    'https://services.swpc.noaa.gov/json/goes/primary/xray-flares-latest.json'
  );
  if (xray?.length){
    const x = xray[0];
    html += `<div class="row"><span class="label">GOES X-ray Flux </span>
      <span>${x.flux ?? '--'} W/m² (${x.class_type ?? '--'})</span></div>`;
    count++;
  }

  /* ── SUNSPOTS ── */
  const sunspots = await fetchJSON(
    'https://services.swpc.noaa.gov/json/sunspot/sunspot.json'
  );
  if (sunspots?.length){
    const s = +sunspots.at(-1).ssn;
    html += `<div class="row"><span class="label">Sunspot Number </span>
      <span class="${color(s,{watch:50,warn:100,danger:200})}">${s}</span></div>`;
    count++;
  }

  /* ── SOLAR FLUX F10.7 ── */
  const f107 = await fetchJSON(
    'https://services.swpc.noaa.gov/json/f107.json'
  );
  if (f107?.length){
    const f = +f107.at(-1).flux;
    html += `<div class="row"><span class="label">Solar Flux F10.7 </span>
      <span class="${color(f,{watch:100,warn:150,danger:200})}">${f} sfu</span></div>`;
    count++;
  }

  /* ── SOLAR FLARES 24H ── */
  const flares = await fetchJSON(
    'https://services.swpc.noaa.gov/json/goes/primary/xray-flares-24h.json'
  );
  if (Array.isArray(flares)){
    html += `<div class="row"><span class="label">Solar Flares 24h </span>
      <span class="${flares.length>5?'val-warn':'val-safe'}">${flares.length}</span></div>`;
    count++;
  }

  /* ── PROTON FLUX >100 MeV ── */
  const proton = await fetchJSON(
    'https://services.swpc.noaa.gov/json/goes/primary/proton-flux.json'
  );
  if (proton?.length){
    const p = proton.at(-1)['>100 MeV'] || 0;
    html += `<div class="row"><span class="label">Proton >100 MeV </span>
      <span class="${color(p,{watch:1,warn:10,danger:100})}">
      ${p.toExponential(1)} p/cm²/s</span></div>`;
    count++;
  }

  /* ── EUV / SOLAR CYCLE INDEX ── */
  const cycle = await fetchJSON(
    'https://services.swpc.noaa.gov/json/solar-cycle/observed-solar-cycle-indices.json'
  );
  if (cycle?.length){
    const u = +cycle.at(-1).euv || 0;
    html += `<div class="row"><span class="label">Solar EUV Index </span>
      <span class="${color(u,{watch:5,warn:8,danger:12})}">${u}</span></div>`;
    count++;
  }

  dataDiv.innerHTML = html;
  statusDiv.textContent = `оновлено • ${count} сонячних сигналів`;
}

loadCosmos();
setInterval(loadCosmos,60000);
</script>
</body>
</html>
